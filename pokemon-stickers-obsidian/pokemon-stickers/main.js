"use strict";var k=Object.defineProperty;var u=(l,c,t)=>c in l?k(l,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[c]=t;var m=(l,c,t)=>u(l,typeof c!="symbol"?c+"":c,t);const p=require("obsidian"),g={noteStickerSize:50};class y extends p.Plugin{constructor(){super(...arguments);m(this,"settings");m(this,"lastFrontMatter",{});m(this,"updateTimeout",null)}async onload(){console.log("Pokémon Stickers Plugin Loaded!"),await this.loadSettings(),this.addSettingTab(new S(this.app,this)),this.addCommand({id:"add-pokemon-sticker",name:"Add Pokémon Sticker",callback:async()=>{const t=this.app.workspace.getActiveViewOfType(p.MarkdownView);!t||!t.file||(await this.assignPokemonToNote(t.file),this.scheduleUpdate())}}),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.scheduleUpdate()})),this.registerEvent(this.app.metadataCache.on("changed",()=>{this.scheduleUpdate()})),setTimeout(()=>this.updateFileExplorerStickers(),500)}async assignPokemonToNote(t){if(!t||!t.path.endsWith(".md"))return;const e=Math.floor(Math.random()*1025)+1,s={name:`Pokémon #${e}`,image:`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${e}.png`};await this.app.fileManager.processFrontMatter(t,o=>{o.pokemon=s})}scheduleUpdate(){this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{this.displaySticker(),this.updateFileExplorerStickers()},50)}displaySticker(){var n,r,i;const t=this.app.workspace.getActiveViewOfType(p.MarkdownView);if(!t||!t.file)return;const e=(n=this.app.metadataCache.getFileCache(t.file))==null?void 0:n.frontmatter;if(JSON.stringify(this.lastFrontMatter)===JSON.stringify(e))return;this.lastFrontMatter=e||{};const s=t.containerEl.querySelector(".inline-title"),o=document.querySelector(`[data-path="${t.file.path}"] .nav-file-title-content`);if(!e||!e.pokemon){(r=s==null?void 0:s.querySelector(".pokemon-sticker"))==null||r.remove(),(i=o==null?void 0:o.querySelector(".pokemon-sticker"))==null||i.remove();return}const a=this.settings.noteStickerSize;this.createOrUpdateSticker(s,e.pokemon,a,"block",t.file),this.createOrUpdateSticker(o,e.pokemon,16,"inline-block",t.file)}createOrUpdateSticker(t,e,s,o,a){if(!t)return;let n=t.querySelector(".pokemon-sticker");const r=t.closest(".nav-file-title");if(n){const i=n.querySelector("img");if(i&&i.src!==e.image){i.src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png";const d=new Image;d.src=e.image,d.onload=()=>{i.src=e.image,i.alt=e.name,i.width=s}}else i.width=s;i.style.cursor=r?"default":"pointer",r||i.addEventListener("click",d=>{d.stopPropagation(),this.showStickerModal(a)})}else{n=document.createElement("span"),n.className="pokemon-sticker",n.style.display=o,n.style.marginRight="8px";const i=document.createElement("img");i.width=s,i.src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png",i.style.opacity="0.5",i.style.cursor=r?"default":"pointer",n.appendChild(i),t.prepend(n);const d=new Image;d.src=e.image,d.onload=()=>{i.src=e.image,i.alt=e.name,i.width=s,i.style.opacity="1"},r||i.addEventListener("click",h=>{h.stopPropagation(),this.showStickerModal(a)})}if(!document.querySelector("#pokemon-sticker-hover-animation")){const i=document.createElement("style");i.id="pokemon-sticker-hover-animation",i.textContent=`
        .pokemon-sticker img {
          transition: transform 0.3s ease-in-out;
        }
  
        .pokemon-sticker:hover img {
          animation: bounce 0.5s ease;
        }
  
        @keyframes bounce {
          0% { transform: scale(1); }
          50% { transform: scale(1.2); }
          100% { transform: scale(1); }
        }
      `,document.head.appendChild(i)}}showStickerModal(t){var r;(r=document.querySelector("#pokemon-sticker-modal"))==null||r.remove();const e=document.createElement("div");e.id="pokemon-sticker-modal",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.background="#333",e.style.color="#fff",e.style.padding="20px",e.style.borderRadius="10px",e.style.boxShadow="0 4px 8px rgba(0,0,0,0.2)",e.style.textAlign="center",e.style.zIndex="1000";const s=document.createElement("h3");s.innerText="Modify Pokémon",e.appendChild(s);const o=document.createElement("button");o.innerText="Randomize Pokémon",o.style.margin="10px",o.style.padding="10px",o.style.border="none",o.style.cursor="pointer",o.style.background="#4CAF50",o.style.color="#fff",o.style.borderRadius="5px",o.addEventListener("click",async()=>{e.remove(),await this.assignPokemonToNote(t),this.scheduleUpdate()}),e.appendChild(o);const a=document.createElement("button");a.innerText="Remove Pokémon",a.style.margin="10px",a.style.padding="10px",a.style.border="none",a.style.cursor="pointer",a.style.background="#D32F2F",a.style.color="#fff",a.style.borderRadius="5px",a.addEventListener("click",async()=>{e.remove(),await this.app.fileManager.processFrontMatter(t,i=>{delete i.pokemon}),this.scheduleUpdate()}),e.appendChild(a);const n=document.createElement("button");n.innerText="Close",n.style.margin="10px",n.style.padding="10px",n.style.border="none",n.style.cursor="pointer",n.style.background="#555",n.style.color="#fff",n.style.borderRadius="5px",n.addEventListener("click",()=>{e.remove()}),e.appendChild(n),document.body.appendChild(e)}async loadSettings(){this.settings=Object.assign({},g,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}updateFileExplorerStickers(){this.app.vault.getMarkdownFiles().forEach(t=>{var o,a;const e=(o=this.app.metadataCache.getFileCache(t))==null?void 0:o.frontmatter,s=document.querySelector(`.nav-file-title[data-path="${t.path}"] .nav-file-title-content`);if(s){if(!(e!=null&&e.pokemon)){(a=s.querySelector(".pokemon-sticker"))==null||a.remove();return}this.createOrUpdateSticker(s,e.pokemon,16,"inline-block",t)}})}updateStickerSize(){this.displaySticker(),this.updateFileExplorerStickers(),this.app.workspace.trigger("layout-change");const t=this.app.workspace.getActiveViewOfType(p.MarkdownView);t&&t.containerEl.querySelectorAll(".pokemon-sticker img").forEach(s=>{s.setAttribute("width",`${this.settings.noteStickerSize}`)})}onunload(){console.log("Pokemon Sticker Plugin Unloaded!")}}class S extends p.PluginSettingTab{constructor(t,e){super(t,e);m(this,"plugin");this.plugin=e}display(){const{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Pokémon Sticker Settings"}),new p.Setting(t).setName("Note Sticker Size").setDesc("Adjust the size of the Pokémon sticker in notes.").addSlider(e=>e.setLimits(20,100,5).setValue(this.plugin.settings.noteStickerSize).onChange(async s=>{this.plugin.settings.noteStickerSize=s,await this.plugin.saveSettings(),this.plugin.updateStickerSize()}))}}module.exports=y;
